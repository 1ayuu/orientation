%main.row
  .cell.well.well--l

    - if @article.archived?
      %p.archived This article has been archived. Please don't trust the information displayed here.
    - if @article.rotten?
      %p.rotten This article has rotten. The information is partially or completely out of date.

    %article
      %header.mbs
        %h1.tsxxl= @article.title
        .byline
          .byline-main
            .byline-author
              %i.icn.icn--avatar.icn--middle
              = link_to @article.author, @article.author.link, class: 'label label--link label--link--invert'
            %span.label.label--invert= @article.created_at_tag
          .byline-secondary
            %span.tsi.tss Last edited
            %span.label.label--invert= @article.updated_at_tag

      .g
        %aside.g-b.g-b--1of6
          = render "tags/tags", tags: @article.tags

        .g-b.g-b--4of6
          .card.markdown.mbm.ptl
            = find_and_preserve do
              = markdown(@article.content || "No content")

          - if user_signed_in?
            = link_to "Edit", edit_article_url(@article), class: "btn btn--a"

            - if !@article.rotten?
              = link_to "Report Rot", report_rot_article_url(@article), class: "btn btn--b", method: :put

            - if @article.stale? || @article.rotten?
              = link_to "Mark Fresh", mark_fresh_article_url(@article), class: "btn btn--b", method: :put

            - toggle_archived_label = !@article.archived? ? "Archive" : "Unarchive"
            = link_to toggle_archived_label, toggle_archived_article_url(@article), class: "btn btn--b", method: :put

            = link_to "Delete", @article, class: "btn btn--b", method: :delete

        %aside.g-b.g-b--1of6
          = link_to "Subscribers", subscriptions_article_path(@article), class: 'dib mbxs mtl'
          / TODO: Add subscribers' image links
          - toggle_subscription_label = current_user.subscribed_to?(@article) ? "Unsubscribe" : "Subscribe"
          = link_to toggle_subscription_label, toggle_subscription_article_url(@article), class: 'btn btn--a', method: :put
